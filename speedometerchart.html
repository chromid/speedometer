<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="robots" content="noindex, nofollow, noarchive, nosnippet"><title>Wykres prędkości</title><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script><style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f8f9fa; color: #343a40; height: 100vh; width: 100vw; overflow: hidden; } .container { height: 100vh; width: 100vw; padding: 20px; display: flex; flex-direction: column; } .header { text-align: center; margin-bottom: 20px; } .chart-container { flex: 1; width: 100%; position: relative; } .status { position: absolute; top: 10px; right: 20px; padding: 8px 12px; border-radius: 4px; font-size: 0.9rem; z-index: 10; } .status.active { background-color: #d4edda; color: #155724; } .status.inactive { background-color: #f8d7da; color: #721c24; } .controls { display: flex; justify-content: center; gap: 10px; margin: 15px 0; } button { background-color: #4361ee; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 500; transition: background-color 0.2s; } button:hover { background-color: #3a56d4; } button:disabled { background-color: #a0aec0; cursor: not-allowed; } .footer { text-align: center; font-size: 0.8rem; color: #6c757d; margin-top: auto; padding: 10px 0; }</style></head><body><div class="container"><div class="header"><h1>Monitor Prędkości</h1></div><div class="controls"><button id="startBtn">Start</button><button id="stopBtn" disabled>Stop</button><button id="resetBtn">Reset</button><button id="downloadBtn">Pobierz CSV</button></div><div class="chart-container"><div id="status" class="status inactive">Wyłączony</div><canvas id="speedChart"></canvas></div><div class="footer"><p>Dane z API Geolokalizacji | Prędkość w m/s</p></div></div><script>const ctx = document.getElementById('speedChart').getContext('2d'); const startBtn = document.getElementById('startBtn'); const stopBtn = document.getElementById('stopBtn'); const resetBtn = document.getElementById('resetBtn'); const downloadBtn = document.getElementById('downloadBtn'); const statusEl = document.getElementById('status'); let watchId = null; let startTime = null; let speedData = []; let chart = null; function initChart() { chart = new Chart(ctx, { type: 'line', data: { labels: [], datasets: [{ label: 'Prędkość (m/s)', data: [], borderColor: '#4361ee', backgroundColor: 'rgba(67, 97, 238, 0.1)', borderWidth: 3, pointRadius: 4, pointBackgroundColor: '#4361ee', pointBorderColor: '#fff', pointHoverRadius: 6, fill: true, tension: 0.2 }] }, options: { responsive: true, maintainAspectRatio: false, interaction: { intersect: false, mode: 'index', }, plugins: { tooltip: { backgroundColor: 'rgba(255, 255, 255, 0.9)', titleColor: '#333', bodyColor: '#333', titleFont: { size: 14, weight: 'bold' }, bodyFont: { size: 13 }, borderColor: '#ddd', borderWidth: 1, padding: 12, displayColors: false, callbacks: { title: function(tooltipItems) { return `Czas: ${tooltipItems[0].label}`; }, label: function(context) { return `Prędkość: ${context.raw.toLocaleString('pl-PL', {maximumFractionDigits: 2})} m/s (${(context.raw * 3.6).toLocaleString('pl-PL', {maximumFractionDigits: 2})} km/h)`; } } }, legend: { display: false } }, scales: { x: { display: true, title: { display: true, text: 'Czas (HH:MM:SS.MS)', font: { size: 14, weight: 'bold' } }, ticks: { callback: function(value, index, values) { return this.getLabelForValue(value); }, maxRotation: 0 }, grid: { color: 'rgba(0, 0, 0, 0.05)' } }, y: { display: true, title: { display: true, text: 'Prędkość (m/s)', font: { size: 14, weight: 'bold' } }, min: 0, suggestedMax: 10, ticks: { callback: function(value) { return value.toLocaleString('pl-PL', {maximumFractionDigits: 1}); } }, grid: { color: 'rgba(0, 0, 0, 0.05)' } } } } }); } function formatTime(timestamp) { const date = new Date(timestamp); const timeString = date.toLocaleString('pl-PL', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }); const milliseconds = date.getMilliseconds().toString().padStart(3, '0'); return `${timeString}.${milliseconds}`; } function updateChart() { if (!chart) return; const timeLabels = speedData.map(d => formatTime(d.timestamp)); const speeds = speedData.map(d => d.speed); chart.data.labels = timeLabels; chart.data.datasets[0].data = speeds; const maxSpeed = Math.max(...speeds, 0.1); chart.options.scales.y.suggestedMax = Math.ceil(maxSpeed * 1.2); chart.update(); } function handlePosition(position) { if (!startTime) { startTime = position.timestamp; } let speed = position.coords.speed; if (speed === null || speed === undefined) { speed = speedData.length > 0 ? speedData[speedData.length - 1].speed : 0; } speed = Math.max(0, speed); speedData.push({ timestamp: position.timestamp, speed: speed, latitude: position.coords.latitude, longitude: position.coords.longitude }); updateChart(); } function handleError(error) { let errorMsg = ""; switch(error.code) { case error.PERMISSION_DENIED: errorMsg = "Użytkownik odmówił dostępu do geolokalizacji."; break; case error.POSITION_UNAVAILABLE: errorMsg = "Informacje o lokalizacji są niedostępne."; break; case error.TIMEOUT: errorMsg = "Upłynął czas żądania lokalizacji."; break; case error.UNKNOWN_ERROR: errorMsg = "Wystąpił nieznany błąd."; break; } alert(`Błąd geolokalizacji: ${errorMsg}`); stopTracking(); } function startTracking() { if (!navigator.geolocation) { alert("Geolokalizacja nie jest wspierana przez Twoją przeglądarkę."); return; } const options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }; try { watchId = navigator.geolocation.watchPosition( handlePosition, handleError, options ); startBtn.disabled = true; stopBtn.disabled = false; statusEl.textContent = "Aktywny"; statusEl.classList.remove("inactive"); statusEl.classList.add("active"); } catch (e) { alert("Błąd podczas inicjowania śledzenia: " + e.message); } } function stopTracking() { if (watchId !== null) { navigator.geolocation.clearWatch(watchId); watchId = null; startBtn.disabled = false; stopBtn.disabled = true; statusEl.textContent = "Wstrzymany"; statusEl.classList.remove("active"); statusEl.classList.add("inactive"); } } function resetData() { stopTracking(); speedData = []; startTime = null; if (chart) { chart.data.labels = []; chart.data.datasets[0].data = []; chart.update(); } statusEl.textContent = "Wyłączony"; } function downloadCSV() { if (speedData.length === 0) { alert("Brak danych do pobrania."); return; } let csvContent = "data:text/csv;charset=utf-8,"; csvContent += "Czas (HH:MM:SS.MS),Czas_Unix,Prędkość (m/s),Prędkość (km/h),Szerokość,Długość\n"; speedData.forEach(function(data) { const formattedTime = formatTime(data.timestamp); const kmhSpeed = (data.speed * 3.6).toLocaleString('pl-PL', {maximumFractionDigits: 2}).replace(',', '.'); const msSpeed = data.speed.toLocaleString('pl-PL', {maximumFractionDigits: 2}).replace(',', '.'); csvContent += `${formattedTime},${data.timestamp},${msSpeed},${kmhSpeed},${data.latitude},${data.longitude}\n`; }); navigator.clipboard.writeText(csvContent) .then(() => { alert("Dane CSV zostały skopiowane do schowka!"); }) .catch(err => { alert("Błąd kopiowania do schowka: " + err); const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", `speed_data_${formatTime(Date.now()).replace(/:/g, '-')}.csv`); document.body.appendChild(link); link.click(); document.body.removeChild(link); }); } startBtn.addEventListener('click', startTracking); stopBtn.addEventListener('click', stopTracking); resetBtn.addEventListener('click', resetData); downloadBtn.addEventListener('click', downloadCSV); window.addEventListener('load', function() { initChart(); }); window.addEventListener('resize', function() { if (chart) { chart.resize(); } });</script></body></html>

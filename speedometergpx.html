<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="robots" content="noindex, nofollow, noarchive, nosnippet"><title>Szybkościomierz z GPX</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"><style> :root { --background: #121212; --surface: #1e1e1e; --primary: #2196f3; --primary-dark: #0d47a1; --text: #ffffff; --text-secondary: #b0bec5; --success: #4caf50; --error: #f44336; } * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, Lato, 'Open Sans', 'Helvetica Neue', Arial, sans-serif; } body { background-color: var(--background); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; transition: all 0.3s ease; } header { background-color: var(--surface); padding: 1rem; box-shadow: 0 2px 4px #0000004d; display: flex; justify-content: space-between; align-items: center; z-index: 10; } header h1 { font-size: 1.5rem; font-weight: 700; color: var(--primary); } .container { flex: 1; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; max-width: 1200px; margin: 0 auto; width: 100%; } .card { background-color: var(--surface); border-radius: 8px; padding: 1rem; box-shadow: 0 2px 8px #00000033; display: flex; flex-direction: column; gap: 1rem; transition: transform 0.3s ease, box-shadow 0.3s ease; } .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px #0000004d; } .card h2 { font-size: 1.2rem; font-weight: 500; color: var(--primary); } .speed-display { display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: 700; color: var(--primary); height: 100px; background-color: #2196f31a; border-radius: 8px; overflow: hidden; position: relative; } .speed-unit { font-size: 1rem; color: var(--text-secondary); margin-left: 0.5rem; } .map-container { height: 640px; border-radius: 8px; overflow: hidden; } #map { height: 100%; width: 100%; } .leaflet-tile { filter: brightness(3); } .leaflet-container { background-color: var(--surface) !important; } .leaflet-control-zoom a { background-color: var(--surface) !important; color: var(--text) !important; border-color: #444 !important; } .leaflet-control-attribution { background-color: #00000080 !important; color: #aaa !important; } .textarea-container { position: relative; } #gpxOutput { width: 100%; height: 150px; background-color: #2196f31a; border: 1px solid #2196f34d; border-radius: 8px; padding: 0.75rem; color: var(--text-secondary); font-family: monospace; font-size: 0.9rem; resize: none; transition: all 0.3s ease; } #gpxOutput:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px #2196f333; } .toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(100px); background-color: var(--success); color: white; padding: 0.75rem 1.5rem; border-radius: 4px; box-shadow: 0 2px 10px #0000004d; z-index: 1000; opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; } .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; } .toast.error { background-color: var(--error); } .button { background-color: var(--primary); color: white; border: none; border-radius: 4px; padding: 0.75rem 1.5rem; font-size: 1rem; cursor: pointer; transition: background-color 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem; } .button:hover { background-color: var(--primary-dark); } .button:active { transform: translateY(1px); } .stats { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; } .stat-card { background-color: #2196f31a; border-radius: 8px; padding: 1rem; display: flex; flex-direction: column; gap: 0.5rem; } .stat-title { font-size: 0.9rem; color: var(--text-secondary); } .stat-value { font-size: 1.5rem; font-weight: 600; color: var(--text); } .dot { width: 12px; height: 12px; background-color: var(--primary);border-radius: 50%; position: relative; } .dot::after { content: ''; position: absolute; width: 20px; height: 20px; background-color: #2196f34d; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: pulse 2s infinite; } @keyframes pulse { 0% {transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } } #status { font-size: 0.9rem; color: var(--text-secondary); } @media (max-width: 960px) { .container { padding: 0.5rem; gap: 0.5rem; } .card { gap: 0.5rem; } .stats { gap: 0.5rem; } .speed-display { height: 100px; font-size: 2.5rem; } .map-container { height: 320px; } #gpxOutput { height: 100px; } }</style></head><body><header><h1>Szybkościomierz z GPX</h1></header><div class="container"><div class="card"><h2>Aktualna szybkość</h2><div class="speed-display"><span id="speed">0</span><span class="speed-unit">km/h</span></div><div id="status">Oczekiwanie na pozycję GPS…</div></div><div class="card"><h2>Mapa trasy</h2><div class="map-container"><div id="map"></div></div></div><div class="card"><h2>GPX trasy</h2><div class="textarea-container"><textarea id="gpxOutput" readonly></textarea></div><button id="reset-route" class="button">Wyczyść GPX</button></div></div><div id="toast" class="toast">Skopiowano do schowka!</div><script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/6.5.0/turf.min.js"></script><script>document.addEventListener('DOMContentLoaded', function () { let map; let userMarker; let userRoute; let routeCoordinates = []; let lastPosition = null; let lastPositionTime = null; let watchId; let gpxPoints = []; const MIN_DISTANCE = 3; const STORAGE_KEY = 'speedTrackerData'; loadFromLocalStorage(); initMap(); startPositionTracking(); document.getElementById('gpxOutput').addEventListener('click', copyGpxToClipboard); document.getElementById('reset-route').addEventListener('click', confirmResetRoute); function initGpxFile() { const gpxHeader = `<?xml version="1.0" encoding="UTF-8"?>\n<gpx version="1.1" creator="Speed Tracker" xmlns="http://www.topografix.com/GPX/1/1">\n  <trk>\n    <name>Route ${new Date().toISOString().split('T')[0]}</name>\n    <trkseg>`; const gpxFooter = `\n    </trkseg>\n  </trk>\n</gpx>`; gpxPoints = []; routeCoordinates = []; document.getElementById('gpxOutput').value = gpxHeader + gpxFooter; saveToLocalStorage(); } function loadFromLocalStorage() { const savedData = localStorage.getItem(STORAGE_KEY); if (savedData) { try { const data = JSON.parse(savedData); gpxPoints = data.gpxPoints || []; routeCoordinates = data.coordinates || []; lastPosition = data.lastPosition || null; lastPositionTime = data.lastPositionTime || null; updateGpxOutput(); document.getElementById('status').textContent = 'Wczytano zapisaną trasę'; } catch (err) { console.error('Błąd podczas wczytywania danych:', err); initGpxFile(); } } else { initGpxFile(); } } function saveToLocalStorage() { const dataToSave = { gpxPoints, coordinates: routeCoordinates, lastPosition, lastPositionTime }; try { localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave)); } catch (err) { console.error('Błąd podczas zapisywania danych:', err); document.getElementById('status').textContent = 'Uwaga: Nie można zapisać danych - pamięć przeglądarki pełna'; } } function initMap() { map = L.map('map', { center: [52.23175, 21.00619], zoom: 16, minZoom: 7, maxZoom: 22 }); L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>', subdomains: 'abcd', maxZoom: 22 }).addTo(map); const initialPosition = lastPosition || [52.23175, 21.00619]; userMarker = L.circleMarker(initialPosition, { radius: 8, fillColor: '#3388ff', color: '#fff', weight: 2, opacity: 1, fillOpacity: 0.8 }).addTo(map); userRoute = L.polyline(routeCoordinates, { color: '#3388ff', weight: 3, opacity: 0.8 }).addTo(map); } function startPositionTracking() { if ('geolocation' in navigator) { if (!lastPosition) { document.getElementById('status').textContent = 'Oczekiwanie na pozycję GPS…'; } const options = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }; watchId = navigator.geolocation.watchPosition( handlePositionUpdate, handlePositionError, options ); } else { document.getElementById('status').textContent = 'Geolokalizacja nie jest wspierana przez tę przeglądarkę'; } } function handlePositionUpdate(position) { const { latitude, longitude, accuracy } = position.coords; const timestamp = position.timestamp || Date.now(); const currentPosition = [latitude, longitude]; document.getElementById('status').textContent = `Dokładność: ${accuracy.toLocaleString("pl-PL", { maximumFractionDigits: 2 })} m`; userMarker.setLatLng(currentPosition); map.setView(currentPosition, 16); if (lastPosition) { const from = turf.point([lastPosition[1], lastPosition[0]]); const to = turf.point([longitude, latitude]); const distance = turf.distance(from, to, { units: 'kilometers' }) * 1000; if (position.speed !== null) { document.getElementById('speed').textContent = (position.coords.speed * 3.6).toLocaleString("pl-PL", { maximumFractionDigits: 2 }); } else { document.getElementById('speed').textContent = "0"; } if (distance >= MIN_DISTANCE) { routeCoordinates.push(currentPosition); userRoute.setLatLngs(routeCoordinates); addGpxPoint(latitude, longitude, timestamp); saveToLocalStorage(); } } else { routeCoordinates.push(currentPosition); userRoute.setLatLngs(routeCoordinates); addGpxPoint(latitude, longitude, timestamp); saveToLocalStorage(); } lastPosition = currentPosition; lastPositionTime = timestamp; } function handlePositionError(error) { switch (error.code) { case error.PERMISSION_DENIED: document.getElementById('status').textContent = 'Brak dostępu do lokalizacji'; break; case error.POSITION_UNAVAILABLE: document.getElementById('status').textContent = 'Pozycja niedostępna'; break; case error.TIMEOUT: document.getElementById('status').textContent = 'Przekroczony czas oczekiwania na pozycję'; break; default: document.getElementById('status').textContent = 'Nieznany błąd lokalizacji'; } } function addGpxPoint(lat, lon, time) { const timeStr = new Date(time).toISOString(); const pointXml = `\n      <trkpt lat="${lat}" lon="${lon}">\n        <time>${timeStr}</time>\n      </trkpt>`; gpxPoints.push(pointXml); updateGpxOutput(); } function updateGpxOutput() { const gpxHeader = `<?xml version="1.0" encoding="UTF-8"?>\n<gpx version="1.1" creator="Speed Tracker" xmlns="http://www.topografix.com/GPX/1/1">\n  <trk>\n    <name>Route ${new Date().toISOString().split('T')[0]}</name>\n    <trkseg>`; const gpxFooter = `\n    </trkseg>\n  </trk>\n</gpx>`; document.getElementById('gpxOutput').value = gpxHeader + gpxPoints.join('') + gpxFooter; } function copyGpxToClipboard() { const gpxTextarea = document.getElementById('gpxOutput'); gpxTextarea.select(); document.execCommand('copy'); const toast = document.getElementById('toast'); toast.classList.add('show'); setTimeout(() => { toast.classList.remove('show'); }, 3000); } function confirmResetRoute() { if (confirm('Czy na pewno chcesz zresetować trasę? Wszystkie zapisane dane zostaną utracone.')) { resetRoute(); } } function resetRoute() { lastPosition = null; lastPositionTime = null; initGpxFile(); routeCoordinates = []; userRoute.setLatLngs(routeCoordinates); userMarker.setLatLng([52.23175, 21.00619]); localStorage.removeItem(STORAGE_KEY); document.getElementById('speed').textContent = '0'; document.getElementById('status').textContent = 'Trasa zresetowana. Oczekiwanie na pozycję GPS…'; map.setView([52.23175, 21.00619], 16); } });</script></body></html>
